<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>neurocaps.analysis.CAP &mdash; neurocaps 0.9.9.post1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b77a3e96" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=6b452a4c"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="neurocaps.analysis.merge_dicts" href="neurocaps.analysis.merge_dicts.html" />
    <link rel="prev" title="neurocaps.extraction.TimeseriesExtractor" href="neurocaps.extraction.TimeseriesExtractor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            neurocaps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api.html#neurocaps-extraction-timeseries-extraction"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.extraction</span></code> - Timeseries Extraction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api.html#neurocaps-analysis-co-activation-patterns-caps-analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code> - Co-Activation Patterns (CAPs) Analysis</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code>.CAP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#neurocaps.analysis.CAP"><code class="docutils literal notranslate"><span class="pre">CAP</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="neurocaps.analysis.merge_dicts.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code>.merge_dicts</a></li>
<li class="toctree-l3"><a class="reference internal" href="neurocaps.analysis.standardize.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code>.standardize</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">neurocaps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../api.html">API</a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code>.CAP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/generated/neurocaps.analysis.CAP.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="neurocaps-analysis-cap">
<h1><a class="reference internal" href="../api.html#module-neurocaps.analysis" title="neurocaps.analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">neurocaps.analysis</span></code></a>.CAP<a class="headerlink" href="#neurocaps-analysis-cap" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">neurocaps.analysis.</span></span><span class="sig-name descname"><span class="pre">CAP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parcel_approach</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_selection_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'elbow'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'silhouette'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP" title="Link to this definition"></a></dt>
<dd><p><strong>Co-Activation Patterns (CAPs) Class</strong></p>
<p>Initializes the CAPs (Co-activation Patterns) class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parcel_approach</strong> (<em>Dict</em><em>[</em><em>Dict</em><em>]</em><em>, </em><em>default=None</em>) – <p>The approach used to parcellate BOLD images. This should be a nested dictionary with the first key being
the atlas name. The sub-keys should include:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;maps&quot;</span></code> : Directory path to the location of the parcellation file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code> : A list of node names in the order of the label IDs in the parcellation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> : The regions or networks in the parcellation.</p></li>
</ul>
</div></blockquote>
<p>If the <code class="docutils literal notranslate"><span class="pre">&quot;Schaefer&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;AAL&quot;</span></code> option was used in the <code class="docutils literal notranslate"><span class="pre">TimeSeriesExtractor</span></code> class, you can initialize
the <code class="docutils literal notranslate"><span class="pre">TimeSeriesExtractor</span></code> class with the <code class="docutils literal notranslate"><span class="pre">parcel_approach</span></code>  that was initially used, then set this
parameter to <code class="docutils literal notranslate"><span class="pre">TimeSeriesExtractor.parcel_approach</span></code>. For this parameter, only <code class="docutils literal notranslate"><span class="pre">&quot;Schaefer&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;AAL&quot;</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&quot;Custom&quot;</span></code> are supported. <strong>Note</strong>, this parameter is not needed for using <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code>; however, for
certain plotting functions it will be needed. This class contains a <code class="docutils literal notranslate"><span class="pre">parcel_approach</span></code> property that also acts
as a setter so <code class="docutils literal notranslate"><span class="pre">self.parcel_approach=parcel_approach</span></code> can be used to set the <code class="docutils literal notranslate"><span class="pre">parcel_approach</span></code> later on.</p>
</p></li>
<li><p><strong>n_clusters</strong> (<em>Union</em><em>[</em><em>int</em><em>, </em><em>List</em><em>[</em><em>int</em><em>]</em><em>]</em><em>, </em><em>default=5</em>) – The number of clusters to use for <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>. Can be a single integer or a list of integers
(if <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>).</p></li>
<li><p><strong>cluster_selection_method</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Method to find the optimal number of clusters. Options are <code class="docutils literal notranslate"><span class="pre">&quot;silhouette&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;elbow&quot;</span></code>.</p></li>
<li><p><strong>groups</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>List</em><em>] or </em><em>None</em><em>, </em><em>default=None</em>) – <p>A mapping of group names to subject IDs. Each group contains subject IDs for separate CAP analysis.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, CAPs are not separated by group. The structure should be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">],</span>
    <span class="s2">&quot;GroupName2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</p></li>
</ul>
</dd>
</dl>
<section id="property">
<h2>Property<a class="headerlink" href="#property" title="Link to this heading"></a></h2>
<dl>
<dt>n_clusters<span class="classifier">int or List[int]</span></dt><dd><p>A single integer or list of integers if <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>) that will used for
<code class="docutils literal notranslate"><span class="pre">KMeans</span></code>.</p>
</dd>
<dt>groups<span class="classifier">Dict[str, List] or None:</span></dt><dd><p>A mapping of groups names to subject IDs.</p>
</dd>
<dt>cluster_selection_method<span class="classifier">str or None:</span></dt><dd><p>The cluster selection method to identify the optimal number of clusters.</p>
</dd>
<dt>parcel_approach<span class="classifier">Dict[str, Dict]</span></dt><dd><p>Nested dictionary containing information about the parcellation. Can also be used as a setter. If <code class="docutils literal notranslate"><span class="pre">&quot;Schaefer&quot;</span></code>
or <code class="docutils literal notranslate"><span class="pre">&quot;AAL&quot;</span></code> was specified during initialization of the <code class="docutils literal notranslate"><span class="pre">TimeseriesExtractor</span></code> class, then <code class="docutils literal notranslate"><span class="pre">nilearn</span></code>’s
<code class="docutils literal notranslate"><span class="pre">datasets.fetch_atlas_schaefer_2018`</span> <span class="pre">and</span> <span class="pre">``datasets.fetch_atlas_aal</span></code> will be used to obtain the <code class="docutils literal notranslate"><span class="pre">&quot;maps&quot;</span></code>
and the <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code>. Then string splitting is used on the <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code> to obtain the <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;Schaefer&quot;</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="s2">&quot;maps&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/parcellation.nii.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;LH_Vis1&quot;</span><span class="p">,</span> <span class="s2">&quot;LH_SomSot1&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_Vis1&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_SomSot1&quot;</span><span class="p">],</span>
        <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Vis&quot;</span><span class="p">,</span> <span class="s2">&quot;SomSot&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="p">{</span>
    <span class="s2">&quot;AAL&quot;</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="s2">&quot;maps&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/parcellation.nii.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Precentral_L&quot;</span><span class="p">,</span> <span class="s2">&quot;Precentral_R&quot;</span><span class="p">,</span> <span class="s2">&quot;Frontal_Sup_L&quot;</span><span class="p">,</span> <span class="s2">&quot;Frontal_Sup_R&quot;</span><span class="p">],</span>
        <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Precentral&quot;</span><span class="p">,</span> <span class="s2">&quot;Frontal&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&quot;Custom&quot;</span></code> is specified, only checks are done to ensure that the dictionary contains the proper sub-keys
such as <code class="docutils literal notranslate"><span class="pre">&quot;maps&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code>. Unlike <code class="docutils literal notranslate"><span class="pre">&quot;Schaefer&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;AAL&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> must be
a nested dictionary specifying the name of the region as the first level key and the indices in the <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code>
list belonging to the <code class="docutils literal notranslate"><span class="pre">&quot;lh&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;rh&quot;</span></code> for that region. Refer to the example for <code class="docutils literal notranslate"><span class="pre">&quot;Custom&quot;</span></code> in
the <strong>Note</strong> section below.</p>
</dd>
<dt>n_cores<span class="classifier">int</span></dt><dd><p>Number of cores to use for multiprocessing with <code class="docutils literal notranslate"><span class="pre">joblib</span></code>. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used
and <code class="docutils literal notranslate"><span class="pre">n_cores</span></code> is specified.</p>
</dd>
<dt>runs<span class="classifier">int or List[int]</span></dt><dd><p>The runs used for the CAPs analysis. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used and <code class="docutils literal notranslate"><span class="pre">runs</span></code> is specified.</p>
</dd>
<dt>caps<span class="classifier">Dict[str, Dict[np.array]]</span></dt><dd><p>The extracted cluster centroids, representing each CAP from the k-means model. It is a nested dictionary
containing the group name, CAP names, and 1D <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps</span></code>
is used. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;CAP-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># 1 x ROI array,</span>
        <span class="s2">&quot;CAP-2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># 1 x ROI array,</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>kmeans<span class="classifier">Dict[str, sklearn.cluster.KMeans]</span></dt><dd><p>Dictionary containing the <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> model used for each group. If <code class="docutils literal notranslate"><span class="pre">cluster_selection__method</span></code> is not
<code class="docutils literal notranslate"><span class="pre">None</span></code>, the <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> model will be the optimal model.  Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used.
The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">KMeans</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>silhouette_scores<span class="classifier">Dict[str, Dict[str, float]]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;silhouette&quot;</span></code>, this property will be a nested dictionary containing
the group name, cluster number, and silhouette score. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used. The
structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>inertia<span class="classifier">Dict[str, Dict[str, float]]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is <code class="docutils literal notranslate"><span class="pre">&quot;elbow&quot;</span></code>, this property will be a nested dictionary containing the
group name, cluster number, and inertia. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used. The structure is as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>optimal_n_clusters<span class="classifier">Dict[str, Dict[int]]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>, this property is a nested dictionary containing the group
name and the optimal number of clusters. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>standardize<span class="classifier">bool</span></dt><dd><p>Boolean denoting whether the features of the concatenated timeseries data was z-scored. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until
<code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used.</p>
</dd>
<dt>epsilon<span class="classifier">float</span></dt><dd><p>A small number added to the denominator when z-scoring for numerical stability.</p>
</dd>
<dt>means<span class="classifier">Dict[str, np.array]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">standardize</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> in <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code>, this property is a nested dictionary containing the
group names and a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array (participants x TR) x ROIs of the means of the features. The structure is as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># Dimensions: 1 x ROIs</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>stdev<span class="classifier">Dict[str, np.array]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">standardize</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> in <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code>, this property is a nested dictionary containing the
group names and a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array (participants x TR) x ROIs of the sample standard deviation of the features.
The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># Dimensions: 1 x ROIs</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>concatenated_timeseries<span class="classifier">Dict[str, np.array]</span></dt><dd><p>Nested dictionary containing the group name and their respective concatenated <code class="docutils literal notranslate"><span class="pre">numpy</span></code> arrays
(participants x TR) x ROIs. Is <code class="docutils literal notranslate"><span class="pre">None</span></code> until <code class="docutils literal notranslate"><span class="pre">self.get_caps()</span></code> is used. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># Dimensions: (participants x TR) x ROIs</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>region_caps<span class="classifier">Dict[str, np.array]:</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">visual_scope</span></code> set to <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> in <code class="docutils literal notranslate"><span class="pre">self.caps2plot()</span></code>, this property is a nested dictionary
containing the group name, CAP names, and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array (1 x region) of the averaged z-score value for each
region. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;CAP-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># 1 x region array,</span>
        <span class="s2">&quot;CAP-2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># 1 x region array,</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>outer_products<span class="classifier">Dict[str, Dict[str, np.array]]</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">plot_options</span></code> set to “ outer product” <code class="docutils literal notranslate"><span class="pre">self.caps2plot()</span></code>, this property is a nested dictionary
containing the group name, CAP names, and <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array (ROI x ROI) of the outer product. The structure is
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;CAP-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># ROI x ROI array,</span>
        <span class="s2">&quot;CAP-2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">...</span><span class="p">])</span> <span class="c1"># ROI x ROI array,</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>If no groups were specified, the default group name will be “All Subjects”.</strong></p>
<p><strong>If using a “Custom” parcellation approach</strong>, ensure each node in your dataset includes both left (lh) and
right (rh) hemisphere versions (bilateral nodes). This function assumes that the background label is “zero”.
Do not add a background label in the <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> key; the zero index should correspond to the
first ID that is not zero.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;maps&quot;</span></code>: Directory path containing necessary parcellation files. Ensure files are in a supported format (e.g.,
.nii for NIfTI files).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code>: List of all node labels used in your study, arranged in the exact order they correspond to indices in
your parcellation files. Each label should match the parcellation index it represents. For example, if the
parcellation label “1” corresponds to the left hemisphere visual cortex area 1, then “LH_Vis1” should occupy
the 0th index in this list. This ensures that data extraction and analysis accurately reflect the anatomical
regions intended.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code>: Dictionary defining major brain regions. Each region should list node indices under
<code class="docutils literal notranslate"><span class="pre">&quot;lh&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;rh&quot;</span></code> to specify left and right hemisphere nodes.</p></li>
</ul>
<p><strong>Different sub-keys are required depending on the function used. Refer to the Note section under each function
for information regarding the sub-keys required for that function.</strong></p>
<p>The provided example demonstrates setting up a custom parcellation containing nodes for the visual network (Vis)
and hippocampus regions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parcel_approach</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Custom&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;maps&quot;</span><span class="p">:</span> <span class="s2">&quot;/location/to/parcellation.nii.gz&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;LH_Vis1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LH_Vis2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LH_Hippocampus&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RH_Vis1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RH_Vis2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RH_Hippocampus&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;Vis&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;lh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;rh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;Hippocampus&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;lh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;rh&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.get_caps">
<span class="sig-name descname"><span class="pre">get_caps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subject_timeseries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'k-means++'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'random'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'k-means++'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_init</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'auto'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">algorithm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'lloyd'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'elkan'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'lloyd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_figs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">figure</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.get_caps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.get_caps" title="Link to this definition"></a></dt>
<dd><p><strong>Perform K-Means Clustering to Generate CAPs</strong></p>
<p>Concatenates the timeseries of each subject into a single <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array with dimensions (participants x TRs) x
ROI and uses <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> on the concatenated data. <strong>Note</strong>, <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> uses euclidean
distance Additionally, the elbow method is determined using <code class="docutils literal notranslate"><span class="pre">KneeLocator</span></code> from the <code class="docutils literal notranslate"><span class="pre">kneed</span></code> package and the
silhouette scores are calculated with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s  <code class="docutils literal notranslate"><span class="pre">silhouette_score</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject_timeseries</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>np.ndarray</em><em>]</em><em>] or </em><em>str</em>) – <p>Path of the pickle file containing the nested subject timeseries dictionary saved by the
<code class="docutils literal notranslate"><span class="pre">TimeSeriesExtractor</span></code> class or the nested subject timeseries dictionary produced by the
<code class="docutils literal notranslate"><span class="pre">TimeseriesExtractor</span></code> class. The first level of the nested dictionary must consist of the subject ID
as a string, the second level must consist of the run numbers in the form of <code class="docutils literal notranslate"><span class="pre">&quot;run-#&quot;</span></code> (where # is the
corresponding number of the run), and the last level must consist of the timeseries (as a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array)
associated with that run. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subject_timeseries</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;101&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;run-0&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
        <span class="p">},</span>
        <span class="s2">&quot;102&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;run-0&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>runs</strong> (<em>int</em><em> or </em><em>List</em><em>[</em><em>int</em><em>] or </em><em>None</em><em>, </em><em>default=None</em>) – The run numbers to perform the CAPs analysis with. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, all runs in the subject timeseries will be
concatenated into a single dataframe and subjected to <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>.</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – The random state to use for <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>. Ensures reproducible results.</p></li>
<li><p><strong>init</strong> (<em>&quot;k-means++&quot;</em><em>, </em><em>&quot;random&quot;</em><em>, or </em><em>array</em><em>, </em><em>default=&quot;k-means++&quot;</em>) – Method for choosing initial cluster centroid for <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>.</p></li>
<li><p><strong>n_init</strong> (<em>&quot;auto&quot;</em><em> or </em><em>int</em><em>, </em><em>default=&quot;auto&quot;</em>) – Number of times <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> is ran with different initial clusters.
The model with lowest inertia from these runs will be selected.</p></li>
<li><p><strong>max_iter</strong> (<em>int</em><em>, </em><em>default=300</em>) – Maximum number of iterations for a single run of <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>.</p></li>
<li><p><strong>tol</strong> (<em>float</em><em>, </em><em>default=1e-4</em><em>,</em>) – Stopping criterion for <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans``if</span> <span class="pre">the</span> <span class="pre">change</span> <span class="pre">in</span> <span class="pre">inertia</span> <span class="pre">is</span> <span class="pre">below</span> <span class="pre">this</span> <span class="pre">value,</span> <span class="pre">assuming</span>
<span class="pre">``max_iter</span></code> has not been reached.</p></li>
<li><p><strong>algorithm</strong> (<em>&quot;lloyd</em><em> or </em><em>&quot;elkan&quot;</em><em>, </em><em>default=&quot;lloyd&quot;</em>) – The type of algorithm to use for <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">KMeans</span></code>. Options are <code class="docutils literal notranslate"><span class="pre">&quot;lloyd&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;elkan&quot;</span></code>.</p></li>
<li><p><strong>show_figs</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Display the plots of inertia scores for all groups if <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&quot;elbow&quot;</span></code>.</p></li>
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save plot to if <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&quot;elbow&quot;</span></code>. The directory will be
created if it does not exist.</p></li>
<li><p><strong>standardize</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to z-score the features of the concatenated timeseries data. The sample standard deviation will
be used, meaning <code class="docutils literal notranslate"><span class="pre">n-1</span></code> in the denominator.</p></li>
<li><p><strong>epsilon</strong> (<em>int</em><em> or </em><em>float</em><em>, </em><em>default=0</em>) – A small number to add to the denominator when z-scoring for numerical stability.</p></li>
<li><p><strong>n_cores</strong> (<em>int</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – The number of CPU cores to use for multiprocessing, with <code class="docutils literal notranslate"><span class="pre">joblib</span></code>, to run multiple <code class="docutils literal notranslate"><span class="pre">KMeans</span></code> models
if <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> is not <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em>) – <p>Dictionary to adjust certain parameters related to <code class="docutils literal notranslate"><span class="pre">cluster_selection_method</span></code> when set to <code class="docutils literal notranslate"><span class="pre">&quot;elbow&quot;</span></code>.
Additional parameters include:</p>
<ul>
<li><dl class="simple">
<dt>S<span class="classifier">int, default=1</span></dt><dd><p>Adjusts the sensitivity of finding the elbow. Larger values are more conservative and less
sensitive to small fluctuations. This package uses <code class="docutils literal notranslate"><span class="pre">KneeLocator</span></code> from the <code class="docutils literal notranslate"><span class="pre">kneed</span></code> package to
identify the elbow. Default is 1.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>dpi<span class="classifier">int, default=300</span></dt><dd><p>Adjusts the dpi of the elbow plot. Default is 300.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>figsize<span class="classifier">Tuple, default=(8,6)</span></dt><dd><p>Adjusts the size of the elbow plots.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>matplotlib.Figure</cite> – An instance of a <cite>matplotlib</cite> figure.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.calculate_metrics">
<span class="sig-name descname"><span class="pre">calculate_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subject_timeseries</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">runs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuous_runs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['temporal</span> <span class="pre">fraction',</span> <span class="pre">'persistence',</span> <span class="pre">'counts',</span> <span class="pre">'transition</span> <span class="pre">frequency']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix_file_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.calculate_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.calculate_metrics" title="Link to this definition"></a></dt>
<dd><p><strong>Get CAPs metrics</strong></p>
<p>Creates a single <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> containing CAP metrics for all participants, as described
Liu et al., 2018 and Yang et al., 2021. The metrics include:</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;temporal</span> <span class="pre">fraction&quot;</span></code>: The proportion of total volumes spent in a single CAP over all volumes in a run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predicted_subject_timeseries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">target</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">temporal_fraction</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">6</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;persistence&quot;</span></code>: The average time spent in a single CAP before transitioning to another CAP
(average consecutive/uninterrupted time).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predicted_subject_timeseries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">target</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># Sequences for 1 are [1] and [1,1,1]</span>
<span class="n">persistence</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Average number of frames</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">if</span> <span class="n">tr</span><span class="p">:</span>
    <span class="n">persistence</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># Turns average frames into average time</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;counts&quot;</span></code>: The frequency of each CAP observed in a run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predicted_subject_timeseries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">target</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">counts</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;transition</span> <span class="pre">frequency&quot;</span></code>: The total number of switches between different CAPs across the entire run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">predicted_subject_timeseries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="c1"># Transitions between unique CAPs occur at indices 0 -&gt; 1, 1 -&gt; 2, and 4 -&gt; 5</span>
<span class="n">transition_frequency</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subject_timeseries</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>np.ndarray</em><em>]</em><em>] or </em><em>str</em>) – <p>Path of the pickle file containing the nested subject timeseries dictionary saved by the
<code class="docutils literal notranslate"><span class="pre">TimeSeriesExtractor</span></code> class or the nested subject timeseries dictionary produced by the
<code class="docutils literal notranslate"><span class="pre">TimeseriesExtractor</span></code> class. The first level of the nested dictionary must consist of the subject ID
as a string, the second level must consist of the run numbers in the form of <code class="docutils literal notranslate"><span class="pre">&quot;run-#&quot;&quot;`</span> <span class="pre">(where</span> <span class="pre">#</span> <span class="pre">is</span> <span class="pre">the</span>
<span class="pre">corresponding</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">run),</span> <span class="pre">and</span> <span class="pre">the</span> <span class="pre">last</span> <span class="pre">level</span> <span class="pre">must</span> <span class="pre">consist</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">timeseries</span> <span class="pre">(as</span> <span class="pre">a</span> <span class="pre">``numpy</span></code> array)
associated with that run. The structure is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subject_timeseries</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;101&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;run-0&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
        <span class="p">},</span>
        <span class="s2">&quot;102&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;run-0&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
            <span class="s2">&quot;run-1&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">timeseries</span><span class="p">]),</span> <span class="c1"># 2D array</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</p></li>
<li><p><strong>tr</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – The repetition time (TR). If provided, persistence will be calculated as the average uninterrupted time
spent in each CAP. If not provided, persistence will be calculated as the average uninterrupted volumes
(TRs) spent in each state.</p></li>
<li><p><strong>runs</strong> (<em>int</em><em> or </em><em>List</em><em>[</em><em>int</em><em>]</em><em>, </em><em>default=None</em>) – The run numbers to calculate CAP metrics for. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, CAP metrics will be calculated for each run.</p></li>
<li><p><strong>continuous_runs</strong> (<em>bool</em><em>, </em><em>default=False</em>) – <p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, all runs will be treated as a single, uninterrupted run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">run_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">continuous_runs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</p></li>
<li><p><strong>metrics</strong> (<em>str</em><em> or </em><em>List</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default=</em><em>[</em><em>&quot;temporal fraction&quot;</em><em>, </em><em>&quot;persistence&quot;</em><em>, </em><em>&quot;counts&quot;</em><em>, </em><em>&quot;transition frequency&quot;</em><em>]</em>) – The metrics to calculate. Available options include <code class="docutils literal notranslate"><span class="pre">&quot;temporal</span> <span class="pre">fraction&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;persistence&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;counts&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;transition</span> <span class="pre">frequency&quot;</span></code>.</p></li>
<li><p><strong>return_df</strong> (<em>str</em><em>, </em><em>default=True</em>) – If True, returns the dataframe.</p></li>
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save dataframe to. The directory will be created if it does not exist. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, dataframe
will not be saved.</p></li>
<li><p><strong>prefix_file_name</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Will serve as a prefix to append to the saved file names for the dataframes, if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is
provided.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>Dict[str, pd.DataFrame]</em> – Dictionary containing <cite>pandas</cite> <cite>DataFrame</cite> - one for each requested metric.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The presence of 0 for specific CAPs in the <code class="docutils literal notranslate"><span class="pre">&quot;temporal</span> <span class="pre">fraction&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;persistence&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;counts&quot;</span></code>
dataframes indicates that the participant had zero instances of a specific CAP. For <code class="docutils literal notranslate"><span class="pre">&quot;transition</span> <span class="pre">frequency&quot;</span></code>,
a 0 indicates no transitions due to all participant’s frames being assigned to a single CAP.</p>
</div>
<p class="rubric">References</p>
<p>Liu, X., Zhang, N., Chang, C., &amp; Duyn, J. H. (2018). Co-activation patterns in resting-state fMRI signals.
NeuroImage, 180, 485–494. <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2018.01.041">https://doi.org/10.1016/j.neuroimage.2018.01.041</a></p>
<p>Yang, H., Zhang, H., Di, X., Wang, S., Meng, C., Tian, L., &amp; Biswal, B. (2021). Reproducible coactivation
patterns of functional brain networks reveal the aberrant dynamic state transition in schizophrenia.
NeuroImage, 237, 118193. <a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2021.118193">https://doi.org/10.1016/j.neuroimage.2021.118193</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.caps2plot">
<span class="sig-name descname"><span class="pre">caps2plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix_title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'outer</span> <span class="pre">product'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">visual_scope</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'regions'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_figs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subplots</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">heatmap</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.caps2plot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.caps2plot" title="Link to this definition"></a></dt>
<dd><p><strong>Generate heatmaps and outer product plots of CAPs</strong></p>
<p>This function produces <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> heatmaps for each CAP. If groups were given when the CAP class was
initialized, plotting will be done for all CAPs for all groups.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save plots to. The directory will be created if it does not exist. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, plots will not
be saved.</p></li>
<li><p><strong>suffix_title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Appended to the title of each plot as well as the name of the saved file if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is provided.</p></li>
<li><p><strong>plot_options</strong> (<em>str</em><em> or </em><em>List</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default=&quot;outer product&quot;</em>) – Type of plots to create. Options are <code class="docutils literal notranslate"><span class="pre">&quot;outer</span> <span class="pre">product&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;heatmap&quot;</span></code>.</p></li>
<li><p><strong>visual_scope</strong> (<em>str</em><em> or </em><em>List</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default=&quot;regions&quot;</em>) – Determines whether plotting is done at the region level or node level.
For region level, the value of each nodes in the same regions (both left and right hemisphere nodes in the
same region) are averaged together then plotted. Options are <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code>.</p></li>
<li><p><strong>show_figs</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to display figures.</p></li>
<li><p><strong>subplots</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to produce subplots for outer product plots.</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em>) – <p>Keyword arguments used when saving figures. Valid keywords include:</p>
<ul>
<li><dl class="simple">
<dt>dpi<span class="classifier">int, default=300</span></dt><dd><p>Dots per inch for the figure. Default is 300 if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is provided and <code class="docutils literal notranslate"><span class="pre">dpi</span></code> is not specified.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>figsize<span class="classifier">Tuple, default=(8, 6)</span></dt><dd><p>Size of the figure in inches.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fontsize<span class="classifier">int, default=14</span></dt><dd><p>Font size for the title of individual plots or subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hspace<span class="classifier">float, default=0.4</span></dt><dd><p>Height space between subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>wspace<span class="classifier">float, default=0.4</span></dt><dd><p>Width space between subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xticklabels_size<span class="classifier">int, default=8</span></dt><dd><p>Font size for x-axis tick labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>yticklabels_size<span class="classifier">int, default=8</span></dt><dd><p>Font size for y-axis tick labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>shrink<span class="classifier">float, default=0.8</span></dt><dd><p>Fraction by which to shrink the colorbar.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nrow<span class="classifier">int, default=varies (max 5)</span></dt><dd><p>Number of rows for subplots. Default varies but the maximum is 5.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ncol<span class="classifier">int, default=None</span></dt><dd><p>Number of columns for subplots. Default varies but the maximum is 5.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>suptitle_fontsize<span class="classifier">float, default=0.7</span></dt><dd><p>Font size for the main title when subplot is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tight_layout<span class="classifier">bool, default=True</span></dt><dd><p>Use tight layout for subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rect<span class="classifier">List[int], default=[0, 0.03, 1, 0.95]</span></dt><dd><p>Rectangle parameter for tight layout when subplots are <code class="docutils literal notranslate"><span class="pre">True</span></code> to fix whitespace issues.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sharey<span class="classifier">bool, default=True</span></dt><dd><p>Share y-axis labels for subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xlabel_rotation<span class="classifier">int, default=0</span></dt><dd><p>Rotation angle for x-axis labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ylabel_rotation<span class="classifier">int, default=0</span></dt><dd><p>Rotation angle for y-axis labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>annot<span class="classifier">bool, default=False</span></dt><dd><p>Add values to cells.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fmt<span class="classifier">str, default=”.2g”</span></dt><dd><p>Modify how the annotated vales are presented.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>linewidths<span class="classifier">float, default=0</span></dt><dd><p>Padding between each cell in the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>borderwidths<span class="classifier">float, default=0</span></dt><dd><p>Width of the border around the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>linecolor<span class="classifier">str, default=”black”</span></dt><dd><p>Color of the line that seperates each cell.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>edgecolors<span class="classifier">str or None, default=None</span></dt><dd><p>Color of the edges.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alpha<span class="classifier">float or None, default=None</span></dt><dd><p>Controls transparancy and ranges from 0 (transparant) to 1 (opaque).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bbox_inches<span class="classifier">str or None, default=”tight”</span></dt><dd><p>Alters size of the whitespace in the saved image.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hemisphere_labels<span class="classifier">bool, default=False</span></dt><dd><p>This option is only available when <code class="docutils literal notranslate"><span class="pre">visual_scope=&quot;nodes&quot;</span></code>. Instead of listing all individual labels
this parameter simplifies the labels to indicate only the left and right hemispheres, with a
division line separating the cells belonging to each hemisphere. If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;edgecolors&quot;</span></code>
will not be used, and both <code class="docutils literal notranslate"><span class="pre">&quot;linewidths&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;linecolor&quot;</span></code> will be applied only to the division
line. This option is available exclusively for <code class="docutils literal notranslate"><span class="pre">&quot;Custom&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;Schaefer&quot;</span></code> parcellations.
<strong>Note</strong>, for the “Custom” option, the parcellation should be organized such that the first half of the
nodes belong to the left hemisphere and the latter half to the right hemisphere.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>cmap<span class="classifier">str, Class, or Function, default=”coolwarm”</span></dt><dd><p>Color map for the cells in the plot. For this parameter, you can use premade color palettes or
create custom ones. Below is a list of valid options:</p>
<blockquote>
<div><ul class="simple">
<li><p>Strings to call <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>’s premade palettes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seaborn</span></code>’s <code class="docutils literal notranslate"><span class="pre">diverging_palette</span></code> function to generate custom palettes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">LinearSegmentedColormap</span></code> to generate custom palettes.</p></li>
<li><p>Other classes or functions compatible with <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vmin<span class="classifier">float, default=None</span></dt><dd><p>The minimum value to display in plots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>vmax<span class="classifier">float, default=None</span></dt><dd><p>The maximum value to display in plots.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>seaborn.heatmap</cite> – An instance of a <cite>seaborn</cite> <cite>heatmap</cite>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>If using “Custom” parcellation approach</strong>, the <code class="docutils literal notranslate"><span class="pre">&quot;nodes&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> sub-keys are required for this
function.</p>
<p>For valid premade paleettes for <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>, refer to <a class="reference external" href="https://seaborn.pydata.org/tutorial/color_palettes.html">https://seaborn.pydata.org/tutorial/color_palettes.html</a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.caps2corr">
<span class="sig-name descname"><span class="pre">caps2corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix_title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_figs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">heatmap</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.caps2corr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.caps2corr" title="Link to this definition"></a></dt>
<dd><p><strong>Generate Correlation Matrix for CAPs</strong></p>
<p>Produces the correlation matrix of all CAPs and visualizes it as a <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> <code class="docutils literal notranslate"><span class="pre">heatmap</span></code>. If groups were
given when the CAP class was initialized, a correlation matrix will be generated for each group.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save plots to. The directory will be created if it does not exist. If <code class="docutils literal notranslate"><span class="pre">None</span></code>,
plots will not be saved.</p></li>
<li><p><strong>suffix_title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Appended to the title of each plot as well as the name of the saved file if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code>
is provided.</p></li>
<li><p><strong>show_figs</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to display figures.</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em>) – <p>Keyword arguments used when modifying figures. Valid keywords include:</p>
<ul>
<li><dl class="simple">
<dt>dpi<span class="classifier">int, default=300</span></dt><dd><p>Dots per inch for the figure. Default is 300 if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is provided and <code class="docutils literal notranslate"><span class="pre">dpi</span></code> is not
specified.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>figsize<span class="classifier">Tuple, default=(8, 6)</span></dt><dd><p>Size of the figure in inches.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fontsize<span class="classifier">int, default=14</span></dt><dd><p>Font size for the title of individual plots or subplots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xticklabels_size<span class="classifier">int, default=8</span></dt><dd><p>Font size for x-axis tick labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>yticklabels_size<span class="classifier">int, default=8</span></dt><dd><p>Font size for y-axis tick labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>shrink<span class="classifier">float, default=0.8</span></dt><dd><p>Fraction by which to shrink the colorbar.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xlabel_rotation<span class="classifier">int, default=0</span></dt><dd><p>Rotation angle for x-axis labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ylabel_rotation<span class="classifier">int, default=0</span></dt><dd><p>Rotation angle for y-axis labels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>annot<span class="classifier">bool, default=False</span></dt><dd><p>Add values to each cell.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fmt<span class="classifier">str, default=”.2g”,</span></dt><dd><p>Modify how the annotated vales are presented.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>linewidths<span class="classifier">float, default=0</span></dt><dd><p>Padding between each cell in the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>borderwidths<span class="classifier">float, default=0</span></dt><dd><p>Width of the border around the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>linecolor<span class="classifier">str, default=”black”</span></dt><dd><p>Color of the line that seperates each cell.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>edgecolors<span class="classifier">str, default=None</span></dt><dd><p>Color of the edges.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alpha<span class="classifier">float, default=None</span></dt><dd><p>Controls transparancy and ranges from 0 (transparant) to 1 (opaque).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bbox_inches<span class="classifier">str or None, default=”tight”</span></dt><dd><p>Alters size of the whitespace in the saved image.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>cmap<span class="classifier">str, Class, or function, default=”coolwarm”</span></dt><dd><p>Color map for the cells in the plot. For this parameter, you can use premade color palettes or
create custom ones.
Below is a list of valid options:</p>
<blockquote>
<div><ul class="simple">
<li><p>Strings to call <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>’s premade palettes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seaborn</span></code>’s <code class="docutils literal notranslate"><span class="pre">diverging_palette</span></code> function to generate custom palettes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">LinearSegmentedColormap</span></code> to generate custom palettes.</p></li>
<li><p>Other classes or functions compatible with <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>.</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>seaborn.heatmap</cite> – An instance of a <cite>seaborn</cite> <cite>heatmap</cite>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For valid premade paleettes for <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>, refer to <a class="reference external" href="https://seaborn.pydata.org/tutorial/color_palettes.html">https://seaborn.pydata.org/tutorial/color_palettes.html</a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.caps2niftis">
<span class="sig-name descname"><span class="pre">caps2niftis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix_file_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Nifti1Image</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.caps2niftis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.caps2niftis" title="Link to this definition"></a></dt>
<dd><p><strong>Standalone Method to Convert CAPs to NifTI Statistical Maps</strong></p>
<p>Converts atlas into a stat map by replacing labels with the corresponding from the cluster centroids then saves
them as compressed NifTI (nii.gz) files. Below is the internal function that converts the cluster centroids
into a NifTI statistical map.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_cap2statmap</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span> <span class="n">cap_vector</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
    <span class="n">atlas</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">)</span>
    <span class="n">atlas_fdata</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="c1"># Get array containing all labels in atlas to avoid issue if atlas labels dont start at 1,</span>
    <span class="c1"># like Nilearn&#39;s AAL map</span>
    <span class="n">target_array</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">atlas_fdata</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cap_vector</span><span class="p">):</span>
        <span class="n">actual_indx</span> <span class="o">=</span> <span class="n">indx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">atlas_fdata</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">atlas_fdata</span> <span class="o">==</span> <span class="n">target_array</span><span class="p">[</span><span class="n">actual_indx</span><span class="p">])]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">stat_map</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">atlas_fdata</span><span class="p">,</span> <span class="n">atlas</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">atlas</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
    <span class="c1"># Add smoothing to stat map to help mitigate potential coverage issues</span>
    <span class="k">if</span> <span class="n">fwhm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stat_map</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">smooth_img</span><span class="p">(</span><span class="n">stat_map</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">)</span>
    <span class="n">retutn</span> <span class="n">stat_map</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite>, default=None) – Directory to save plots to. The directory will be created if it does not exist.</p></li>
<li><p><strong>suffix_title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Appended to the name of the saved file.</p></li>
<li><p><strong>fwhm</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Strength of spatial smoothing to apply (in millimeters) to the statistical map prior to interpolating
from MNI152 space to fslr surface space. Note, this can assist with coverage issues in the plot.
Uses <code class="docutils literal notranslate"><span class="pre">nilearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">image.smooth</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><cite>NifTI1Image</cite> – <cite>NifTI</cite> statistical map.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.caps2surf">
<span class="sig-name descname"><span class="pre">caps2surf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix_title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_figs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fslr_density</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'32k'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_stat_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fslr_giftis_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Plot</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.caps2surf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.caps2surf" title="Link to this definition"></a></dt>
<dd><p><strong>Project CAPs onto Surface Plots</strong></p>
<p>If not using precomputed GifTI file, this function converts the parcellation used for spatial dimensionality
reduction into a NifTI statistical map by replacing labels with the corresponding value from the cluster
centroids, converts the NifTI stastical map into fsLR (surface) space (using <code class="docutils literal notranslate"><span class="pre">neuromaps</span></code>’s <code class="docutils literal notranslate"><span class="pre">mni152_to_fslr</span></code>),
which also turns it into a <cite>tuple-of-nib.GiftiImage</cite> that can be plotted using <code class="docutils literal notranslate"><span class="pre">surfplot</span></code>’s <code class="docutils literal notranslate"><span class="pre">Plot</span></code>.
If <code class="docutils literal notranslate"><span class="pre">self.caps2niftis()</span></code> was used to convert the parcellation into a NifTI statistical map and an external
tool such as Connectome Workbench was used to convert these NifTI files into GifTI files in fsLR (surface)
space, then the <code class="docutils literal notranslate"><span class="pre">fslr_giftis_dict</span></code> parameter can be used for plotting. Here, <code class="docutils literal notranslate"><span class="pre">neuromaps</span></code>’s <code class="docutils literal notranslate"><span class="pre">fslr_to_fslr</span></code>
is used to convert the image into a <cite>tuple-of-nib.GiftiImage</cite> form that can be plotted by <code class="docutils literal notranslate"><span class="pre">surfplot</span></code>’s
<code class="docutils literal notranslate"><span class="pre">Plot</span></code>. Below is the internal function that converts the cluster centroids into a NifTI statistical map.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_cap2statmap</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">,</span> <span class="n">cap_vector</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
    <span class="n">atlas</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">atlas_file</span><span class="p">)</span>
    <span class="n">atlas_fdata</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">.</span><span class="n">get_fdata</span><span class="p">()</span>
    <span class="c1"># Get array containing all labels in atlas to avoid issue if atlas labels dont start at 1,</span>
    <span class="c1"># like Nilearn&#39;s AAL map</span>
    <span class="n">target_array</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">atlas_fdata</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cap_vector</span><span class="p">):</span>
        <span class="n">actual_indx</span> <span class="o">=</span> <span class="n">indx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">atlas_fdata</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">atlas_fdata</span> <span class="o">==</span> <span class="n">target_array</span><span class="p">[</span><span class="n">actual_indx</span><span class="p">])]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">stat_map</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">atlas_fdata</span><span class="p">,</span> <span class="n">atlas</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">atlas</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
    <span class="c1"># Add smoothing to stat map to help mitigate potential coverage issues</span>
    <span class="k">if</span> <span class="n">fwhm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stat_map</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">smooth_img</span><span class="p">(</span><span class="n">stat_map</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stat_map</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save plots to. The directory will be created if it does not exist. If None, plots will not
be saved.</p></li>
<li><p><strong>suffix_title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Appended to the title of each plot as well as the name of the saved file if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is provided.</p></li>
<li><p><strong>show_figs</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to display figures.</p></li>
<li><p><strong>fwhm</strong> (<em>float</em><em> or </em><em>None</em><em>, </em><em>defualt=None</em>) – Strength of spatial smoothing to apply (in millimeters) to the statistical map prior to interpolating
from MNI152 space to fsLR surface space. Uses <code class="docutils literal notranslate"><span class="pre">nilearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">image.smooth</span></code>.
Note, this can assist with coverage issues in the plot.</p></li>
<li><p><strong>fslr_density</strong> (<em>str</em><em>, </em><em>default=&quot;32k&quot;</em>) – Density of the fsLR surface when converting from MNI152 space to fsLR surface. Options are “32k” or
“164k”. If using <code class="docutils literal notranslate"><span class="pre">fslr_giftis_dict</span></code> options are “4k”, “8k”, “32k”, and “164k”.</p></li>
<li><p><strong>method</strong> (<em>str</em><em>, </em><em>default=&quot;linear&quot;</em>) – Interpolation method to use when converting from MNI152 space to fsLR surface or from fsLR to fsLR. Options
are <code class="docutils literal notranslate"><span class="pre">&quot;linear&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;nearest&quot;</span></code>.</p></li>
<li><p><strong>save_stat_map</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, saves the statistical map for each CAP for all groups as a <cite>Nifti1Image</cite> if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is
provided.</p></li>
<li><p><strong>fslr_giftis_dict</strong> (<em>dict</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – <p>Dictionary specifying precomputed GifTI files in fsLR space for plotting stat maps. This parameter
should be used if the statistical CAP NIfTI files (can be obtained using <code class="docutils literal notranslate"><span class="pre">self.caps2niftis()</span></code>) were
converted to GifTI files using a tool such as Connectome Workbench.The dictionary structure is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;GroupName&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;CAP-Name&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;lh&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/left_hemisphere_gifti&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rh&quot;</span><span class="p">:</span> <span class="s2">&quot;path/to/right_hemisphere_gifti&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>GroupName can be “All Subjects” or any specific group name. CAP-Name is the name of the CAP. This
parameter allows plotting without re-running the analysis. Initialize the CAP class and use this method
if using this parameter.</p>
</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em>) – <p>Additional parameters to pass to modify certain plot parameters. Options include:</p>
<ul>
<li><dl class="simple">
<dt>dpi<span class="classifier">int, default=300</span></dt><dd><p>Dots per inch for the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>title_pad<span class="classifier">int, default=-3</span></dt><dd><p>Padding for the plot title.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cmap<span class="classifier">str or Class, default=”cold_hot”</span></dt><dd><p>Colormap to be used for the plot. For this parameter, you can use premade color palettes orcreate
custom ones. Below is a list of valid options:</p>
<ul>
<li><p>Strings to call <code class="docutils literal notranslate"><span class="pre">nilearn</span></code>’s <code class="docutils literal notranslate"><span class="pre">_cmap_d</span></code> fuction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">LinearSegmentedColormap</span></code> to generate custom colormaps.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cbar_kws<span class="classifier">Dict, default={“location”: “bottom”, “n_ticks”: 3}</span></dt><dd><p>Customize colorbar. Refer to <code class="docutils literal notranslate"><span class="pre">_add_colorbars</span></code> at for valid kwargs in <code class="docutils literal notranslate"><span class="pre">surfplot's</span></code> <code class="docutils literal notranslate"><span class="pre">Plot</span></code>
documentation listed in the <cite>Note</cite> section.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alpha<span class="classifier">float, default=1</span></dt><dd><p>Transparency level of the colorbar.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>zero_transparent<span class="classifier">bool, default=True</span></dt><dd><p>Turns vertices with a value of 0 transparent.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>as_outline<span class="classifier">bool, default=False</span></dt><dd><p>Plots only an outline of contiguous vertices with the same value.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>size<span class="classifier">Tuple, default=(500, 400)</span></dt><dd><p>Size of the plot in pixels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>layout<span class="classifier">str, default=”grid”</span></dt><dd><p>Layout of the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>zoom<span class="classifier">float, default=1.5</span></dt><dd><p>Zoom level for the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>views<span class="classifier">List[str], default=[“lateral”, “medial”]</span></dt><dd><p>Views to be displayed in the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>brightness<span class="classifier">float, default=0.5</span></dt><dd><p>Brightness level of the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>figsize<span class="classifier">Tuple or None, default=None</span></dt><dd><p>Size of the figure.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>scale<span class="classifier">Tuple, default=(2, 2)</span></dt><dd><p>Scale factors for the plot.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>surface<span class="classifier">str, default=”inflated”</span></dt><dd><p>The surface atlas that is used for plotting. Options are <code class="docutils literal notranslate"><span class="pre">&quot;inflated&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;veryinflated&quot;</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>color_range<span class="classifier">Tuple or None, default=None</span></dt><dd><p>The minimum and maximum value to display in plots. For instance, (-1,1) where minimum
value is first. If None, the minimum and maximum values from the image will be used.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>NifTI1Image</cite> – <cite>NifTI</cite> statistical map.</p></li>
<li><p><cite>surfplot.Plot</cite> – An instance of a <cite>surfplot</cite> <cite>Plot</cite>.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For this to work, <code class="docutils literal notranslate"><span class="pre">parcel_approach</span></code> must have the <code class="docutils literal notranslate"><span class="pre">&quot;maps&quot;</span></code> sub-key containing the path to the NifTI file of
the atlas. Assumes that atlas background label is zero and atlas is in MNI space. Also assumes that the indices
from the cluster centroids are related to the atlas by an offset of one. For instance, index 0 of the cluster
centroid vector is the first nonzero label, which is assumed to be at the first index of the array in
<code class="docutils literal notranslate"><span class="pre">sorted(np.unique(atlas_fdata))</span></code>.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neurocaps.analysis.CAP.caps2radar">
<span class="sig-name descname"><span class="pre">caps2radar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">PathLike</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix_title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_figs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_scatterpolar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">line_polar</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Scatterpolar</span></span></span><a class="reference internal" href="../_modules/neurocaps/analysis/cap.html#CAP.caps2radar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neurocaps.analysis.CAP.caps2radar" title="Link to this definition"></a></dt>
<dd><p><strong>Generate Radar Plots</strong></p>
<p>This method identifies networks/regions (across both hemispheres) in each CAP that show high amplitude (high
activation relative to the mean zero if z-scored) and low amplitude (high deactivation relative to the mean
zero if z-scored) by using cosine similarity. This is accomplished by extracting the cluster centroids (CAPs),
a 1 x ROI vector, and generating a binary vector (a vector 1 x ROI vector consisting of 0’s and 1’s) where 1’s
indicate the indices/ROIs (Regions of Interest) in a specific region (in the left and right hemispheres).
For instance, if elements at indices 0, 1, 4, and 5 in the cluster centroid are nodes in the Visual Network,
then a binary vector is generated where those indices are 1, and all others are 0. This binary vector
essentially operates like a 1-dimensional binary mask to capture relevant ROIs in a given region.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Nodes in order of their label ID, &quot;LH_Vis1&quot; is the 0th index in the parcellation</span>
<span class="c1"># but has a label ID of 1, and RH_SomSot2 is in the 7th index but has a label ID</span>
<span class="c1"># of 8 in the parcellation.</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LH_Vis1&quot;</span><span class="p">,</span> <span class="s2">&quot;LH_Vis2&quot;</span><span class="p">,</span> <span class="s2">&quot;LH_SomSot1&quot;</span><span class="p">,</span> <span class="s2">&quot;LH_SomSot2&quot;</span><span class="p">,</span>
         <span class="s2">&quot;RH_Vis1&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_Vis2&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_SomSot1&quot;</span><span class="p">,</span> <span class="s2">&quot;RH_SomSot2&quot;</span><span class="p">]</span>
<span class="c1"># Binary representation of the nodes in Vis, essentially acts as</span>
<span class="c1"># a mask isolating the modes for for Vis</span>
<span class="n">binary_vector</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Cluster centroid for CAP 1</span>
<span class="n">cap_1_cluster_centroid</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
<span class="c1"># Dot product is the sum of all the values here [-0.3, 1.5, 0, 0, 0.7, 1.3, 0, 0]</span>
<span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cap_1_cluster_centroid</span><span class="p">,</span> <span class="n">binary_vector</span><span class="p">)</span>
</pre></div>
</div>
<p>Once, the dot product of the cluster centroid and binary vector is then calculated it is normalized by the
product of the norms of the cluster centroid and the binary vector to restrict the range to -1 and 1, hence
cosine similarity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">norm_cap_1_cluster_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cap_1_cluster_centroid</span><span class="p">)</span>
<span class="n">norm_binary_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">binary_vector</span><span class="p">)</span>
<span class="c1"># Cosine similarity between CAP 1 and the visual network</span>
<span class="n">cosine_similarity</span> <span class="o">=</span> <span class="n">dot_product</span><span class="o">/</span><span class="p">(</span><span class="n">norm_cap_1_cluster_centroid</span> <span class="o">*</span> <span class="n">norm_binary_vector</span><span class="p">)</span>
</pre></div>
</div>
<p>Cosine similarities notably above zero suggest that many nodes in that network/region are highly activating
together, cosine similarities around zero suggest that nodes in that network/region are co-activating and
deactivating together, and cosine similarities notably below zero suggest that many nodes in that
network/region are deactivating together.</p>
<p>This method is a useful quantitative method to characterize CAPs based on nodes in region/networks that
display high co-activation or high co-deactivation. For instance, if the dorsal attention network (DAN) has the
highest cosine similarity and the ventral attention network (VAN) has a lowest cosine similarity, then that cap
can be described as (DAN +/VAN -).</p>
<p><strong>Note, the radar plots only display positive values. The “Low Amplitude” group are negative cosine similarity
(below zero); however, the absolute value was taken to make them positive so that the radar plot starts at 0
and direct magnitude comparisons between the “High Amplitude” (positive cosine similarity above zero) and
“Low Amplitude” groups are easier to see.</strong></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_dir</strong> (<cite>os.PathLike</cite> or None, default=None) – Directory to save plots to. The directory will be created if it does not exist.</p></li>
<li><p><strong>suffix_title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Appended to the title of each plot as well as the name of the saved file if <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> is provided.</p></li>
<li><p><strong>show_figs</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to display figures. If this function detects that it is not being ran in an interactive Python
environment, then it uses <code class="docutils literal notranslate"><span class="pre">plotly.offline</span></code>, creates an html file named “temp-plot.html”, and opens each
plot in the default browser.</p></li>
<li><p><strong>use_scatterpolar</strong> (<em>bool=False</em>) – Uses <code class="docutils literal notranslate"><span class="pre">plotly</span></code>’s <code class="docutils literal notranslate"><span class="pre">Scatterpolar</span></code> instead of <code class="docutils literal notranslate"><span class="pre">plotly</span></code>’s <code class="docutils literal notranslate"><span class="pre">line_polar</span></code>. The primary difference is that
<code class="docutils literal notranslate"><span class="pre">Scatterpolar</span></code> shows the scatter dots. However, this can be acheived with <code class="docutils literal notranslate"><span class="pre">line_polar</span></code> by setting
<code class="docutils literal notranslate"><span class="pre">mode</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;markers+lines&quot;</span></code>. There also seems to be a difference in default opacity behavior.</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em>) – <p>Additional parameters to pass to modify certain plot parameters. Options include:</p>
<ul>
<li><dl class="simple">
<dt>scale<span class="classifier">int, default=2</span></dt><dd><p>Controls resolution of image when saving.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>savefig_options<span class="classifier">Dict[str], default={“width”: 3, “height”: 3, “scale”: 1}</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> provided, controls the width (in inches), height (in inches), and scale of the
plot.
The height and width are multiplied by the dpi.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>height<span class="classifier">int, default=800</span></dt><dd><p>Height of the plot. Value is multiplied by the dpi when saving.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>width<span class="classifier">int, defualt=1200</span></dt><dd><p>Width of the plot. Value is multiplied by the dpi when saving.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>line_close<span class="classifier">int, default=True</span></dt><dd><p>Whether to close the lines</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bgcolor<span class="classifier">str, default=”white”</span></dt><dd><p>Color of the background</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>scattersize<span class="classifier">int, default=8</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">use_scatterpolar=True</span></code>, controls the size of the dots.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>connectgaps<span class="classifier">bool, default=True</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">use_scatterpolar=True</span></code>, controls if missing values are connected.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>opacity<span class="classifier">float, default=0.5,</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">use_scatterpolar=True</span></code>, sets the opacity of the trace.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fill<span class="classifier">str, default=”none”.</span></dt><dd><p>If “toself” the are of the dots and within the boundaries of the line will be filled.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>mode<span class="classifier">str, default=”markers+lines”,</span></dt><dd><p>Determines how the trace is drawn. Can include “lines”, “markers”, “lines+markers”, “lines+markers+text”.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>radialaxis<span class="classifier">Dict[str], default={“showline”: False, “linewidth”: 2, “linecolor”: “rgba(0, 0, 0, 0.25)”, “gridcolor”: “rgba(0, 0, 0, 0.25)”, “ticks”: “outside”,”tickfont”: {“size”: 14, “color”: “black”}}</span></dt><dd><p>Customizes the radial axis.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>angularaxis<span class="classifier">Dict[str], default= {“showline”: True, “linewidth”: 2, “linecolor”: “rgba(0, 0, 0, 0.25)”, “gridcolor”: “rgba(0, 0, 0, 0.25)”, “tickfont”: {“size”: 16, “color”: “black”}}</span></dt><dd><p>Customizes the angular axis.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>color_discrete_map<span class="classifier">Dict[str], default={“High Amplitude”: “red”, “Low Amplitude”: “blue”},</span></dt><dd><p>Change color of the “High Amplitude” and “Low Amplitude” groups. Must use the keys
“High Amplitude” and “Low Amplitude” to work.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>title_font<span class="classifier">Dict[str], default={“family”: “Times New Roman”, “size”: 30, “color”: “black”}</span></dt><dd><p>Modifies the font of the title.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>title_x<span class="classifier">float, default=0.5</span></dt><dd><p>Modifies x position of title.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>title_y<span class="classifier">float, default=None</span></dt><dd><p>Modifies y position of title.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>legend<span class="classifier">Dict[str], default={“yanchor”: “top”, “xanchor”: “left”, “y”: 0.99, “x”: 0.01,”title_font_family”: “Times New Roman”, “font”: {“size”: 12, “color”: “black”}}</span></dt><dd><p>Customizes the legend.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>engine<span class="classifier">str, default=”kaleido”</span></dt><dd><p>Engine used for saving plots.</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>plotly.express.line_polar</cite> – An instance of a <cite>plotly</cite> <cite>line_polar</cite> radar plot.</p></li>
<li><p><cite>plotly.express.Scatterplot</cite> – An instance of a <cite>plotly</cite> <cite>Scatterplot</cite> radar plot.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, this function uses <code class="docutils literal notranslate"><span class="pre">&quot;kaleido&quot;</span></code> (which is also a dependency in this package) to save plots.
For other engines such as <code class="docutils literal notranslate"><span class="pre">&quot;orca&quot;</span></code>, those packages must be installed seperately.</p>
<p><strong>If using “Custom” parcellation approach</strong>, the <code class="docutils literal notranslate"><span class="pre">&quot;regions&quot;</span></code> sub-key is required.</p>
<p>In this code, if the <code class="docutils literal notranslate"><span class="pre">tickvals</span></code> or  <code class="docutils literal notranslate"><span class="pre">range</span></code> sub-keys in this code are not specified in the <code class="docutils literal notranslate"><span class="pre">radialaxis</span></code>
kwarg, then four values are shown - 0.25*(max value), 0.50*(max value), 0.75*(max value), and the max value.</p>
<p>For valid keys for <code class="docutils literal notranslate"><span class="pre">radialaxis</span></code> refer to <code class="docutils literal notranslate"><span class="pre">plotly</span></code>’s documentation at
Refer to <a class="reference external" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.layout.polar.radialaxis.html">https://plotly.com/python-api-reference/generated/plotly.graph_objects.layout.polar.radialaxis.html</a> or
<a class="reference external" href="https://plotly.com/python/reference/layout/polar/">https://plotly.com/python/reference/layout/polar/</a> for valid kwargs.</p>
<p>For valid keys for <code class="docutils literal notranslate"><span class="pre">angularaxis</span></code> refer to <code class="docutils literal notranslate"><span class="pre">plotly</span></code>’s documentation at
<a class="reference external" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.layout.polar.angularaxis.html">https://plotly.com/python-api-reference/generated/plotly.graph_objects.layout.polar.angularaxis.html</a> or
<a class="reference external" href="https://plotly.com/python/reference/layout/polar/">https://plotly.com/python/reference/layout/polar/</a> for valid kwargs.</p>
<p>For valid keys for <code class="docutils literal notranslate"><span class="pre">legend</span></code> and <code class="docutils literal notranslate"><span class="pre">title_font</span></code>, Refer to <code class="docutils literal notranslate"><span class="pre">plotly</span></code>’s documentation at
<a class="reference external" href="https://plotly.com/python/reference/layout/">https://plotly.com/python/reference/layout/</a> for valid kwargs.</p>
</div>
<p class="rubric">References</p>
<p>Zhang, R., Yan, W., Manza, P., Shokri-Kojori, E., Demiral, S. B., Schwandt, M., Vines, L., Sotelo, D., Tomasi,
D., Giddens, N. T., Wang, G., Diazgranados, N., Momenan, R., &amp; Volkow, N. D. (2023). Disrupted brain state
dynamics in opioid and alcohol use disorder: attenuation by nicotine use. Neuropsychopharmacology, 49(5),
876–884. <a class="reference external" href="https://doi.org/10.1038/s41386-023-01750-w">https://doi.org/10.1038/s41386-023-01750-w</a></p>
</dd></dl>

</section>
</dd></dl>

<div style='clear:both'></div></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="neurocaps.extraction.TimeseriesExtractor.html" class="btn btn-neutral float-left" title="neurocaps.extraction.TimeseriesExtractor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="neurocaps.analysis.merge_dicts.html" class="btn btn-neutral float-right" title="neurocaps.analysis.merge_dicts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, neurocaps developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>